#
# spec file for package libstorage (Version @VERSION@)
#
# norootforbuild

Name:		libstorage
Version:	@VERSION@
Release:	0
License:	GPL
Group:		System/Libraries
BuildRoot:	%{_tmppath}/%{name}-%{version}-build
Source:		libstorage-%{version}.tar.bz2

prefix:		/usr

BuildRequires:	gcc-c++ boost-devel blocxx-devel doxygen dejagnu python-devel swig

Requires:	parted mdadm lvm2 dmraid multipath-tools cryptsetup kpartx

PreReq:		%fillup_prereq
Obsoletes:	yast2-storage-lib
Provides:	yast2-storage-lib
Summary:	-

%description
This package is a part of YaST2. It contains the necessary scripts to
configure disk storage.

%prep
%setup -n libstorage-%{version}

%build
export CFLAGS="$RPM_OPT_FLAGS -DNDEBUG"
export CXXFLAGS="$RPM_OPT_FLAGS -DNDEBUG"

aclocal
libtoolize --force --automake --copy
autoheader
automake --add-missing --copy
autoconf

%{?suse_update_config:%{suse_update_config -f}}
./configure --libdir=%{_libdir} --prefix=%{prefix} --mandir=%{_mandir}
make %{?jobs:-j%jobs}

%ifarch s390 s390x
sed -i -e 's/DEVICE_NAMES=".*"/DEVICE_NAMES="path"/' data/sysconfig.storage-libstorage
%endif

%check
make check

%install
make install DESTDIR="$RPM_BUILD_ROOT"

install -d -m 755 $RPM_BUILD_ROOT/var/lock/libstorage

%{find_lang} libstorage

rm -f $RPM_BUILD_ROOT/%{_libdir}/python%{py_ver}/site-packages/_libstorage.a
rm -f $RPM_BUILD_ROOT/%{_libdir}/python%{py_ver}/site-packages/_libstorage.la

%clean
rm -rf "$RPM_BUILD_ROOT"

%files -f libstorage.lang
%defattr(-,root,root)
%{_libdir}/libstorage.so.*
%dir /var/lock/libstorage
/var/adm/fillup-templates/sysconfig.storage-libstorage
%doc %dir %{prefix}/share/doc/packages/libstorage
%doc %{prefix}/share/doc/packages/libstorage/AUTHORS
%doc %{prefix}/share/doc/packages/libstorage/COPYING

%post
/sbin/ldconfig
%{fillup_only -an storage}

%postun
/sbin/ldconfig

%package devel
Requires:	libstorage = %version
Requires:	gcc-c++ libstdc++-devel boost-devel blocxx-devel
Summary:	-
Group:		Development/Languages/C and C++

%description devel
-

%files devel
%defattr(-,root,root)
%{_libdir}/libstorage.la
%{_libdir}/libstorage.so
%{prefix}/include/storage
%doc %{prefix}/share/doc/packages/libstorage/autodocs
%doc %{prefix}/share/doc/packages/libstorage/examples

%package python
Requires:	libstorage = %version
Summary:	-
Group:		Development/Languages/Python

%description python
-

%files python
%defattr(-,root,root)
%{_libdir}/python%{py_ver}/site-packages/libstorage.py*
%attr(755,root,root) %{_libdir}/python%{py_ver}/site-packages/_libstorage.so
